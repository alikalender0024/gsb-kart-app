// ===============================
//  DATABASE CONFIG
// ===============================
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ===============================
//  USER DOMAIN
// ===============================
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  firstName String
  lastName  String?
  createdAt DateTime @default(now())

  profile       UserProfile?
  sessions      AuthSession[]
  cards         Card[]
  purchases     Purchase[]
  tickets       Ticket[]
  notifications Notification[]
  qrOperations  QrOperation[]
}

// ===============================
//  USER PROFILE
// ===============================
model UserProfile {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  phone     String?
  birthDate DateTime?

  user User @relation(fields: [userId], references: [id])
}

// ===============================
//  AUTH SESSION
// ===============================
model AuthSession {
  id        Int      @id @default(autoincrement())
  userId    Int
  token     String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

// ===============================
//  CARD DOMAIN
// ===============================
model Card {
  id           Int      @id @default(autoincrement())
  userId       Int
  cardNumber   String   @unique
  balance      Float    @default(0)
  createdAt    DateTime @default(now())

  user         User         @relation(fields: [userId], references: [id])
  transactions Transaction[]
}

// ===============================
//  TRANSACTION
// ===============================
model Transaction {
  id        Int           @id @default(autoincrement())
  cardId    Int
  amount    Float
  type      TransactionType
  createdAt DateTime       @default(now())

  card         Card         @relation(fields: [cardId], references: [id])
  qrOperations QrOperation[]   // <-- EKLENDÄ°
}

// ===============================
//  ENUMS
// ===============================
enum TransactionType {
  LOAD
  SPEND
}

// ===============================
//  QR OPERATION
// ===============================
model QrOperation {
  id            Int          @id @default(autoincrement())
  userId        Int
  transactionId Int?
  createdAt     DateTime     @default(now())

  user        User        @relation(fields: [userId], references: [id])
  transaction Transaction? @relation(fields: [transactionId], references: [id])
}


// ===============================
//  PRODUCT
// ===============================
model Product {
  id    Int     @id @default(autoincrement())
  name  String
  price Float

  purchases Purchase[]
}

// ===============================
//  PURCHASE
// ===============================
model Purchase {
  id        Int      @id @default(autoincrement())
  userId    Int
  productId Int
  quantity  Int
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}

// ===============================
//  EVENT
// ===============================
model Event {
  id        Int      @id @default(autoincrement())
  name      String
  date      DateTime

  tickets Ticket[]
}

// ===============================
//  TICKET
// ===============================
model Ticket {
  id        Int      @id @default(autoincrement())
  userId    Int
  eventId   Int
  createdAt DateTime @default(now())

  event Event @relation(fields: [eventId], references: [id])
  user  User  @relation(fields: [userId], references: [id])
}

// ===============================
//  NOTIFICATION
// ===============================
model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  message   String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}
